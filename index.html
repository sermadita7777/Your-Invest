<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Invest</title>
    <link rel="icon" href="img/logoYourTrade-removebg-preview.png" type="image/x-icon">
    <link rel="stylesheet" href="styles/index.css">
    <link rel="stylesheet" href="styles/responsive.css">

</head>
<body>
    <div id="loader-bg" style="background: transparent;">
        <svg class="loader-briefcase" viewBox="0 0 90 70">
            <path class="handle" d="M30 20 Q45 5 60 20" />
            <path class="body" d="M15 20 H75 V60 H15 Z" />
            <path class="body" d="M15 35 H75" />
        </svg>
    </div>
    <div class="app-container"> 
        <!-- Fondo animado: gradiente y part√≠culas -->
        <canvas id="bg-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;border-radius:0;" tabindex="-1"></canvas>
        <header class="header" style="position:relative;overflow:hidden;">
            <canvas id="header-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%;z-index:0;pointer-events:none;opacity:0.45;"></canvas>
            <div class="logo" style="position:relative;z-index:1;">Your Invest</div>
            <div class="profile-icon" style="position:relative;z-index:1;">S</div>
        </header>

        <!-- Home Screen -->
        <div id="homeScreen" class="screen active">
            <section class="balance-section">
                <div class="balance-label">Portfolio Value</div>
                <div class="balance-amount" id="balance">‚Ç¨10,000.00</div>
                <div class="balance-change" id="change">+‚Ç¨0.00 (+0.00%) today</div>
            </section>

            <div class="action-buttons">
                <button class="action-btn primary" onclick="showDepositFormPopup()">Deposit</button>
                <button class="action-btn secondary" onclick="showWithdrawModal()">Withdraw</button>
            </div>
    <!-- Deposit Popup Form -->
    <div id="depositFormPopup" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:3000;align-items:center;justify-content:center;pointer-events:none;">
        <div id="depositFormInner" style="background:rgba(34,34,34,0.92);border-radius:24px;padding:38px 32px 32px 32px;box-shadow:0 8px 32px rgba(59,130,246,0.18);text-align:center;position:relative;pointer-events:auto;min-width:280px;max-width:90vw;width:400px;">
            <div style="font-size:32px;font-weight:700;color:#3b82f6;margin-bottom:10px;">Deposit Funds</div>
            <div style="font-size:18px;color:#fff;margin-bottom:18px;">Enter the amount you want to deposit:</div>
            <input type="number" id="depositAmountInput" min="1" placeholder="Amount (‚Ç¨)" style="width:80%;padding:10px;font-size:18px;border-radius:8px;border:none;margin-bottom:18px;">
            <div>
                <button class="action-btn primary" onclick="confirmDepositPopup()">Confirm</button>
                <button class="action-btn secondary" onclick="closeDepositFormPopup()" style="margin-left:12px;">Cancel</button>
            </div>
        </div>
    </div>
    <script>
    function showDepositFormPopup() {
        document.getElementById('depositFormPopup').style.display = 'flex';
        const input = document.getElementById('depositAmountInput');
        input.value = '';
        input.focus();
        input.onkeydown = function(e) {
            if (e.key === 'Enter') {
                confirmDepositPopup();
            } else if (e.key === 'Escape') {
                closeDepositFormPopup();
            }
        };
    }
    function closeDepositFormPopup() {
        document.getElementById('depositFormPopup').style.display = 'none';
    }
    function confirmDepositPopup() {
        const amount = parseFloat(document.getElementById('depositAmountInput').value);
        if (amount && !isNaN(amount) && amount > 0) {
            closeDepositFormPopup();
            // Llama a la funci√≥n de dep√≥sito en app.js si existe
            if (typeof window.depositFromPopup === 'function') {
                window.depositFromPopup(amount);
            }
        } else {
            document.getElementById('depositAmountInput').focus();
        }
    }
    </script>

            <div class="search-bar">
                <span class="search-icon">üîç</span>
                <input type="text" class="search-input" placeholder="Search stocks..." id="searchInput">
            </div>

            <div class="section-title">Market</div>
            <div class="stocks-list" id="stocksList"></div>
        </div>

        <!-- Portfolio Screen -->
        <div id="portfolioScreen" class="screen">
            <section class="balance-section">
                <div class="balance-label">Total Value</div>
                <div class="balance-amount" id="portfolioBalance">‚Ç¨10,000.00</div>
                <div class="balance-change" id="portfolioChange">+‚Ç¨0.00 (+0.00%)</div>
            </section>
            
            <div class="section-title">Your Investments</div>
            <div class="stocks-list" id="portfolioList"></div>
        </div>

        <!-- Tutorials Screen -->
        <div id="tutorialsScreen" class="screen">
            <div class="section-title">Investment Academy</div>
            <div id="tutorialsList"></div>
        </div>

        <div style="height: 100px;"></div>

        <nav class="bottom-nav">
            <div class="nav-item active" onclick="switchScreen('home')">
                <div class="nav-icon">üìä</div>
                <div class="nav-label">Home</div>
            </div>
            <div class="nav-item" onclick="switchScreen('portfolio')">
                <div class="nav-icon">üíº</div>
                <div class="nav-label">Portfolio</div>
            </div>
            <div class="nav-item" onclick="switchScreen('tutorials')">
                <div class="nav-icon">üéì</div>
                <div class="nav-label">Academy</div>
            </div>
            <div class="nav-item" onclick="switchScreen('settings')">
                <div class="nav-icon">‚öôÔ∏è</div>
                <div class="nav-label">Settings</div>
            </div>
        </nav>
    
    <!-- Settings Screen  -->
    <div id="settingsScreen" class="screen">
        <div class="section-title">Settings</div>
        
        <div class="settings-section">
            <div class="settings-category">
                <div class="settings-category-title">üë§ Account</div>
                <div class="settings-item" onclick="showEditProfile()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">‚úèÔ∏è</div>
                        <div>
                            <div class="settings-item-title">Edit Profile</div>
                            <div class="settings-item-subtitle">Change your name and avatar</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
                <div class="settings-item" onclick="showLanguageSelector()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üåç</div>
                        <div>
                            <div class="settings-item-title">Language</div>
                            <div class="settings-item-subtitle" id="currentLanguage">English</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
            </div>

            <div class="settings-category">
                <div class="settings-category-title">üí∞ Portfolio</div>
                <div class="settings-item" onclick="showResetPortfolio()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üîÑ</div>
                        <div>
                            <div class="settings-item-title">Reset Portfolio</div>
                            <div class="settings-item-subtitle">Start fresh with ‚Ç¨10,000</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üíµ</div>
                        <div>
                            <div class="settings-item-title">Initial Capital</div>
                            <div class="settings-item-subtitle">Your starting balance</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <span id="initialCapital">‚Ç¨10,000</span>
                    </div>
                </div>
            </div>

            <div class="settings-category">
                <div class="settings-category-title">üé® Appearance</div>
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üåô</div>
                        <div>
                            <div class="settings-item-title">Dark Mode</div>
                            <div class="settings-item-subtitle">Always enabled</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" checked disabled>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-item" onclick="toggleAnimations()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">‚ú®</div>
                        <div>
                            <div class="settings-item-title">Animations</div>
                            <div class="settings-item-subtitle">Enable smooth transitions</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="animationsToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="settings-category">
                <div class="settings-category-title">üìä Market Data</div>
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">‚ö°</div>
                        <div>
                            <div class="settings-item-title">Real-time Updates</div>
                            <div class="settings-item-subtitle">Update every 5 seconds</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="realtimeToggle" checked onchange="toggleRealtime()">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-item" onclick="showVolatilitySettings()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üìà</div>
                        <div>
                            <div class="settings-item-title">Market Volatility</div>
                            <div class="settings-item-subtitle" id="volatilityLevel">Normal</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
            </div>

            <div class="settings-category">
                <div class="settings-category-title">üîî Notifications</div>
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üì¢</div>
                        <div>
                            <div class="settings-item-title">Price Alerts</div>
                            <div class="settings-item-subtitle">Get notified of big moves</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="alertsToggle">
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üéâ</div>
                        <div>
                            <div class="settings-item-title">Success Confetti</div>
                            <div class="settings-item-subtitle">Celebrate your trades</div>
                        </div>
                    </div>
                    <div class="settings-toggle">
                        <label class="toggle-switch">
                            <input type="checkbox" id="confettiToggle" checked>
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="settings-category">
                <div class="settings-category-title">‚ÑπÔ∏è About</div>
                <div class="settings-item" onclick="showAbout()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">üì±</div>
                        <div>
                            <div class="settings-item-title">About Your Invest</div>
                            <div class="settings-item-subtitle">Version 1.0.0</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
                <div class="settings-item" onclick="showHelp()">
                    <div class="settings-item-left">
                        <div class="settings-item-icon">‚ùì</div>
                        <div>
                            <div class="settings-item-title">Help & Support</div>
                            <div class="settings-item-subtitle">Get assistance</div>
                        </div>
                    </div>
                    <div class="settings-item-arrow">‚Ä∫</div>
                </div>
            </div>

            <div class="settings-footer">
                <p>Made with üíô by Your Invest Team</p>
                <p style="font-size: 12px; color: #666; margin-top: 8px;">
                    This is a simulation for educational purposes only.
                </p>
            </div>
        </div>
    </div>

    </div>
    
    <!-- Trade Modal -->
    <div id="tradeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="modalTitle">Buy</div>
                <div class="close-btn" onclick="closeModal()">&times;</div>
            </div>
            <div class="modal-stock-info">
                <div style="font-size: 32px; margin-bottom: 10px;" id="modalStockIcon"></div>
                <div style="font-size: 20px; font-weight: 600;" id="modalStockName"></div>
                <div style="font-size: 14px; color: #888; margin-top: 5px;" id="modalStockSymbol"></div>
                <div style="font-size: 24px; font-weight: 700; margin-top: 15px; color: #00ff88;" id="modalStockPrice"></div>
            </div>
                <input type="number" class="quantity-input" id="quantityInput" placeholder="Quantity" min="1" value="1">
            <div class="total-cost" id="totalCost">Total: ‚Ç¨0.00</div>
            <button class="confirm-btn" onclick="executeTrade()">Confirm Purchase</button>
        </div>
    </div>

    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="tutorial-modal">
        <div class="tutorial-content">
            <div class="tutorial-close" onclick="closeTutorial()">‚Üê</div>
            <div id="tutorialLessons"></div>
        </div>
    </div>


    <!-- Settings Modals -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title" id="settingsModalTitle">Settings</div>
                <div class="close-btn" onclick="closeSettingsModal()">&times;</div>
            </div>
            <div id="settingsModalContent"></div>
        </div>
    </div>

    <script src="scripts/app.js">
        // Permite dep√≥sito desde el popup de formulario
window.depositFromPopup = function(amount) {
    state.cash += parseFloat(amount);
    updateBalance();
    showActionPopup('deposit', `You deposited ‚Ç¨${parseFloat(amount).toFixed(2)}`);
}
        // Estado de la aplicaci√≥n
        const state = {
            cash: 10000,
            portfolio: {},
            currentScreen: 'home',
            currentTradeStock: null,
            tutorials: {
                basics: { completed: 0, total: 3 },
                stocks: { completed: 0, total: 4 },
                risk: { completed: 0, total: 3 }
            }
        };

        const stocks = [
            { name: 'Apple Inc.', symbol: 'AAPL', price: 178.45, change: 2.34, icon: 'üçé' },
            { name: 'Tesla Inc.', symbol: 'TSLA', price: 242.18, change: -1.56, icon: '‚ö°' },
            { name: 'Microsoft Corp.', symbol: 'MSFT', price: 378.91, change: 3.12, icon: 'üíª' },
            { name: 'Amazon.com Inc.', symbol: 'AMZN', price: 145.32, change: 1.89, icon: 'üì¶' },
            { name: 'NVIDIA Corp.', symbol: 'NVDA', price: 495.67, change: 5.43, icon: 'üéÆ' },
            { name: 'Alphabet Inc.', symbol: 'GOOGL', price: 138.21, change: -0.78, icon: 'üî§' },
            { name: 'Meta Platforms', symbol: 'META', price: 312.44, change: 2.67, icon: 'üì±' }
        ];

        function showDepositModal() {
            const amount = prompt('How much do you want to deposit? (‚Ç¨)');
            if (amount && !isNaN(amount) && amount > 0) {
                state.cash += parseFloat(amount);
                updateBalance();
                alert(`You deposited ‚Ç¨${parseFloat(amount).toFixed(2)}`);
            }
        }

        function showWithdrawModal() {
            const amount = prompt('How much do you want to withdraw? (‚Ç¨)');
            if (amount && !isNaN(amount) && amount > 0) {
                if (parseFloat(amount) <= state.cash) {
                    state.cash -= parseFloat(amount);
                    updateBalance();
                    alert(`You withdrew ‚Ç¨${parseFloat(amount).toFixed(2)}`);
                } else {
                    alert('Insufficient funds');
                }
            }
        }

        const tutorials = [
            {
                id: 'basics',
                title: 'Investment Fundamentals',
                icon: 'üìö',
                description: 'Learn the basic concepts of the stock market and how to start investing.',
                lessons: [
                    {
                        title: 'What are stocks?',
                        content: 'Stocks represent a share of ownership in a company. When you buy stocks, you become a shareholder and own a small part of that company. Companies issue stocks to raise capital and fund their growth.',
                        quiz: {
                            question: 'What do you get when you buy shares of a company?',
                            options: [
                                'A loan to the company',
                                'Partial ownership of the company',
                                'A job at the company',
                                'Free products'
                            ],
                            correct: 1
                        }
                    },
                    {
                        title: 'Supply and Demand',
                        content: 'The price of stocks is determined by supply and demand. If more people want to buy a stock (high demand), the price goes up. If more people want to sell (high supply), the price goes down. This is the fundamental principle of the market.',
                        quiz: {
                            question: 'What happens when there are more buyers than sellers?',
                            options: [
                                'The price goes down',
                                'The price stays the same',
                                'The price goes up',
                                'The stock stops trading'
                            ],
                            correct: 2
                        }
                    },
                    {
                        title: 'Diversification',
                        content: 'Diversification means not putting all your eggs in one basket. Investing in different companies, sectors, and asset types reduces risk. If one investment performs poorly, others can compensate.',
                        quiz: {
                            question: 'Why is diversification important?',
                            options: [
                                'To make more money quickly',
                                'To reduce risk',
                                'Because it is mandatory',
                                'To pay less taxes'
                            ],
                            correct: 1
                        }
                    }
                ]
            },
            {
                id: 'stocks',
                title: 'Stock Analysis',
                icon: 'üìà',
                description: 'Discover how to analyze and select the best stocks for your portfolio.',
                lessons: [
                    {
                        title: 'Fundamental Analysis',
                        content: 'Fundamental analysis evaluates the intrinsic value of a company by examining its finances, management, competitive advantage, and growth prospects. It includes reviewing financial statements, ratios like P/E (price/earnings), and the overall health of the business.',
                        quiz: {
                            question: 'What does fundamental analysis examine?',
                            options: [
                                'Only price charts',
                                'The company‚Äôs finances and health',
                                'Market rumors',
                                'Only the current price'
                            ],
                            correct: 1
                        }
                    },
                    {
                        title: 'Financial Ratios',
                        content: 'Key ratios include: P/E (how much you pay for each euro of profit), ROE (return on equity), and debt/equity (level of indebtedness). A low P/E may indicate an undervalued stock, but you should always consider the sector context.',
                        quiz: {
                            question: 'What does the P/E ratio indicate?',
                            options: [
                                'Price relative to earnings',
                                'The age of the company',
                                'Number of employees',
                                'Total sales'
                            ],
                            correct: 0
                        }
                    },
                    {
                        title: 'Market Capitalization',
                        content: 'Market capitalization (market cap) is the total value of all a company‚Äôs shares. It is calculated by multiplying the share price by the total number of shares. Companies are classified as: small cap (< ‚Ç¨2B), mid cap (‚Ç¨2B-‚Ç¨10B), and large cap (> ‚Ç¨10B).',
                        quiz: {
                            question: 'How is market capitalization calculated?',
                            options: [
                                'Price √ó Number of shares',
                                'Annual profits',
                                'Total assets',
                                'Yearly sales'
                            ],
                            correct: 0
                        }
                    },
                    {
                        title: 'Dividends',
                        content: 'Dividends are regular payments that some companies make to their shareholders from their profits. Not all companies pay dividends; some prefer to reinvest earnings in growth. Dividend yield is calculated as: annual dividend / share price.',
                        quiz: {
                            question: 'What are dividends?',
                            options: [
                                'Loans from the company',
                                'Payments to shareholders from profits',
                                'Government bonds',
                                'Trading commissions'
                            ],
                            correct: 1
                        }
                    }
                ]
            },
            {
                id: 'risk',
                title: 'Risk Management',
                icon: 'üõ°Ô∏è',
                description: 'Learn how to protect your capital and manage risk in your investments.',
                lessons: [
                    {
                        title: 'Types of Risk',
                        content: 'There are several types of risk: market risk (general market movements), company-specific risk (problems of a particular company), sector risk (problems in an industry), and liquidity risk (difficulty selling). Understanding these risks helps you make better decisions.',
                        quiz: {
                            question: 'What is market risk?',
                            options: [
                                'Problems of a specific company',
                                'General market movements',
                                'Only affects cryptocurrencies',
                                'There is no such risk'
                            ],
                            correct: 1
                        }
                    },
                    {
                        title: 'Stop Loss and Take Profit',
                        content: 'A stop loss is an automatic order to sell if the price falls to a certain level, limiting your losses. A take profit does the opposite: it sells automatically when you reach your profit target. These tools help you manage emotions and protect your capital.',
                        quiz: {
                            question: 'What is a stop loss for?',
                            options: [
                                'To make more money',
                                'To automatically limit losses',
                                'To buy more shares',
                                'To pay fewer commissions'
                            ],
                            correct: 1
                        }
                    },
                    {
                        title: 'Time Horizon',
                        content: 'Your investment horizon (how long you plan to hold your investments) affects your risk strategy. Short-term investments (< 1 year) are more volatile. In the long term (5+ years) you can take on more risk because you have time to recover from market downturns.',
                        quiz: {
                            question: 'Why does the long term allow more risk?',
                            options: [
                                'Because it is safer',
                                'You have time to recover from losses',
                                'Commissions are lower',
                                'Taxes are lower'
                            ],
                            correct: 1
                        }
                    }
                ]
            }
        ];

        // Funciones de navegaci√≥n
        function switchScreen(screen) {
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            
            if (screen === 'home') {
                document.getElementById('homeScreen').classList.add('active');
                document.querySelectorAll('.nav-item')[0].classList.add('active');
                state.currentScreen = 'home';
                renderStocks();
            } else if (screen === 'portfolio') {
                document.getElementById('portfolioScreen').classList.add('active');
                document.querySelectorAll('.nav-item')[1].classList.add('active');
                state.currentScreen = 'portfolio';
                renderPortfolio();
            } else if (screen === 'tutorials') {
                document.getElementById('tutorialsScreen').classList.add('active');
                document.querySelectorAll('.nav-item')[2].classList.add('active');
                state.currentScreen = 'tutorials';
                renderTutorials();
            }
        }

        // Render stock list
        function renderStocks(filter = '') {
            const stocksList = document.getElementById('stocksList');
            stocksList.innerHTML = '';
            
            const filteredStocks = stocks.filter(stock => 
                stock.name.toLowerCase().includes(filter.toLowerCase()) || 
                stock.symbol.toLowerCase().includes(filter.toLowerCase())
            );

            if (filteredStocks.length === 0) {
                stocksList.innerHTML = '<div class="empty-state"><div class="empty-icon">üîç</div><div>No stocks found</div></div>';
                return;
            }
            
            filteredStocks.forEach(stock => {
                const changeClass = stock.change >= 0 ? 'positive' : 'negative';
                const changeSymbol = stock.change >= 0 ? '+' : '';
                
                const stockItem = document.createElement('div');
                stockItem.className = 'stock-item';
                stockItem.onclick = () => openTradeModal(stock);
                
                stockItem.innerHTML = `
                    <div class="stock-icon">${stock.icon}</div>
                    <div class="stock-info">
                        <div class="stock-name">${stock.name}</div>
                        <div class="stock-symbol">${stock.symbol}</div>
                    </div>
                    <div class="stock-price-info">
                        <div class="stock-price">‚Ç¨${stock.price.toFixed(2)}</div>
                        <div class="stock-change ${changeClass}">${changeSymbol}${stock.change.toFixed(2)}%</div>
                    </div>
                `;
                
                stocksList.appendChild(stockItem);
            });
        }

        // Render portfolio
        function renderPortfolio() {
            const portfolioList = document.getElementById('portfolioList');
            portfolioList.innerHTML = '';
            
            const portfolioKeys = Object.keys(state.portfolio);
            
            if (portfolioKeys.length === 0) {
                portfolioList.innerHTML = '<div class="empty-state"><div class="empty-icon">üíº</div><div>Your portfolio is empty<br><small>Buy your first stock in the Home section</small></div></div>';
                return;
            }
            
            portfolioKeys.forEach(symbol => {
                const holding = state.portfolio[symbol];
                const stock = stocks.find(s => s.symbol === symbol);
                const currentValue = holding.shares * stock.price;
                const profit = currentValue - holding.totalCost;
                const profitPercent = ((profit / holding.totalCost) * 100).toFixed(2);
                
                const portfolioItem = document.createElement('div');
                portfolioItem.className = 'portfolio-item';
                
                portfolioItem.innerHTML = `
                    <div class="portfolio-left">
                        <div class="portfolio-stock-name">${stock.name}</div>
                        <div class="portfolio-shares">${holding.shares} shares ¬∑ ${stock.symbol}</div>
                    </div>
                    <div class="portfolio-right">
                        <div class="portfolio-value">‚Ç¨${currentValue.toFixed(2)}</div>
                        <div class="portfolio-profit ${profit >= 0 ? 'stock-change positive' : 'stock-change negative'}">
                            ${profit >= 0 ? '+' : ''}‚Ç¨${profit.toFixed(2)} (${profit >= 0 ? '+' : ''}${profitPercent}%)
                        </div>
                    </div>
                `;
                
                portfolioList.appendChild(portfolioItem);
            });
        }

        // Buy modal
        function openTradeModal(stock) {
            state.currentTradeStock = stock;
            document.getElementById('modalTitle').textContent = 'Buy';
            document.getElementById('modalStockIcon').textContent = stock.icon;
            document.getElementById('modalStockName').textContent = stock.name;
            document.getElementById('modalStockSymbol').textContent = stock.symbol;
            document.getElementById('modalStockPrice').textContent = `‚Ç¨${stock.price.toFixed(2)}`;
            document.getElementById('quantityInput').value = 1;
            updateTotalCost();
            document.getElementById('tradeModal').classList.add('active');
        }

        function closeModal() {
            document.getElementById('tradeModal').classList.remove('active');
            state.currentTradeStock = null;
        }

        function updateTotalCost() {
            const quantity = parseInt(document.getElementById('quantityInput').value) || 0;
            const total = quantity * state.currentTradeStock.price;
            document.getElementById('totalCost').textContent = `Total: ‚Ç¨${total.toFixed(2)}`;
        }

        function executeTrade() {
            const quantity = parseInt(document.getElementById('quantityInput').value);
            const stock = state.currentTradeStock;
            const totalCost = quantity * stock.price;
            
            if (quantity <= 0) {
                alert('Please enter a valid quantity');
                return;
            }
            
            if (totalCost > state.cash) {
                alert('Insufficient funds');
                return;
            }
            
            state.cash -= totalCost;
            
            if (state.portfolio[stock.symbol]) {
                state.portfolio[stock.symbol].shares += quantity;
                state.portfolio[stock.symbol].totalCost += totalCost;
            } else {
                state.portfolio[stock.symbol] = {
                    shares: quantity,
                    totalCost: totalCost
                };
            }
            
            updateBalance();
            closeModal();
            showPurchasePopup(`You bought ${quantity} shares of ${stock.name} (${stock.symbol})! üöÄ`);
        }

        // Update balance
        function updateBalance() {
            let portfolioValue = 0;
            Object.keys(state.portfolio).forEach(symbol => {
                const stock = stocks.find(s => s.symbol === symbol);
                portfolioValue += state.portfolio[symbol].shares * stock.price;
            });
            
            const totalValue = state.cash + portfolioValue;
            const change = totalValue - 10000;
            const changePercent = ((change / 10000) * 100).toFixed(2);
            
            document.getElementById('balance').textContent = `‚Ç¨${totalValue.toFixed(2)}`;
            document.getElementById('portfolioBalance').textContent = `‚Ç¨${totalValue.toFixed(2)}`;
            
            const changeText = `${change >= 0 ? '+' : ''}‚Ç¨${change.toFixed(2)} (${change >= 0 ? '+' : ''}${changePercent}%)`;
            document.getElementById('change').textContent = changeText;
            document.getElementById('portfolioChange').textContent = changeText;
            
            document.getElementById('change').className = change >= 0 ? 'balance-change' : 'balance-change negative';
            document.getElementById('portfolioChange').className = change >= 0 ? 'balance-change' : 'balance-change negative';
        }

        // Renderizar tutoriales
        function renderTutorials() {
            const tutorialsList = document.getElementById('tutorialsList');
            tutorialsList.innerHTML = '';
            
            tutorials.forEach(tutorial => {
                const progress = state.tutorials[tutorial.id];
                const progressPercent = (progress.completed / progress.total) * 100;
                
                const card = document.createElement('div');
                card.className = 'tutorial-card';
                card.onclick = () => openTutorial(tutorial);
                
                card.innerHTML = `
                    <div class="tutorial-header">
                        <div class="tutorial-icon">${tutorial.icon}</div>
                        <div class="tutorial-title">${tutorial.title}</div>
                    </div>
                    <div class="tutorial-description">${tutorial.description}</div>
                    <div class="tutorial-progress">
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressPercent}%"></div>
                        </div>
                        <span>${progress.completed}/${progress.total}</span>
                    </div>
                `;
                
                tutorialsList.appendChild(card);
            });
        }

        // Abrir tutorial interactivo
        function openTutorial(tutorial) {
            const modal = document.getElementById('tutorialModal');
            const lessonsContainer = document.getElementById('tutorialLessons');
            lessonsContainer.innerHTML = '';
            
            tutorial.lessons.forEach((lesson, index) => {
                const lessonCard = document.createElement('div');
                lessonCard.className = 'lesson-card';
                
                lessonCard.innerHTML = `
                    <div class="lesson-number">Lecci√≥n ${index + 1}</div>
                    <div class="lesson-title">${lesson.title}</div>
                    <div class="lesson-text">${lesson.content}</div>
                    <div class="quiz-question">
                        <div class="quiz-title">üéØ Pregunta de repaso</div>
                        <div style="margin-bottom: 12px;">${lesson.quiz.question}</div>
                        ${lesson.quiz.options.map((option, i) => `
                            <div class="quiz-option" onclick="checkAnswer(${i}, ${lesson.quiz.correct}, this, '${tutorial.id}', ${index})">${option}</div>
                        `).join('')}
                    </div>
                `;
                
                lessonsContainer.appendChild(lessonCard);
            });
            
            modal.classList.add('active');
        }

        function closeTutorial() {
            document.getElementById('tutorialModal').classList.remove('active');
            renderTutorials();
        }

        function checkAnswer(selected, correct, element, tutorialId, lessonIndex) {
            const options = element.parentElement.querySelectorAll('.quiz-option');
            options.forEach(opt => {
                opt.style.pointerEvents = 'none';
            });
            
            if (selected === correct) {
                element.classList.add('correct');
                
                if (lessonIndex >= state.tutorials[tutorialId].completed) {
                    state.tutorials[tutorialId].completed = lessonIndex + 1;
                }
                
                setTimeout(() => {
                    alert('¬°Correcto! üéâ');
                }, 300);
            } else {
                element.classList.add('incorrect');
                options[correct].classList.add('correct');
                setTimeout(() => {
                    alert('Incorrecto. Revisa la lecci√≥n nuevamente.');
                }, 300);
            }
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', (e) => {
            renderStocks(e.target.value);
        });

        document.getElementById('quantityInput').addEventListener('input', updateTotalCost);

        // Simulaci√≥n de cambios de precio
        setInterval(() => {
            stocks.forEach(stock => {
                const changePercent = (Math.random() - 0.5) * 2;
                stock.price *= (1 + changePercent / 100);
                stock.change = changePercent;
            });
            
            if (state.currentScreen === 'home') {
                renderStocks(document.getElementById('searchInput').value);
            } else if (state.currentScreen === 'portfolio') {
                renderPortfolio();
            }
            
            updateBalance();
        }, 5000);

        // Inicializar
        renderStocks();
        updateBalance();
    </script>
    <!-- Purchase Popup -->
    <div id="purchasePopup" style="display:none;position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:3000;align-items:center;justify-content:center;pointer-events:none;">
        <div id="purchasePopupInner" style="background:rgba(34,34,34,0.92);border-radius:24px;padding:38px 32px 32px 32px;box-shadow:0 8px 32px rgba(59,130,246,0.18);text-align:center;position:relative;pointer-events:auto;min-width:280px;max-width:90vw;width:400px;">
            <div style="font-size:32px;font-weight:700;color:#3b82f6;margin-bottom:10px;">Congratulations!</div>
            <div id="purchaseMsg" style="font-size:18px;color:#fff;margin-bottom:18px;"></div>
            <div id="confettiContainer" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;"></div>
        </div>
    </div>
    <style>
    @media (max-width: 600px) {
        #purchasePopupInner {
            width: 90vw !important;
            min-width: 0 !important;
            max-width: 95vw !important;
            padding: 28px 10vw 24px 10vw !important;
        }
    }
    </style>
    
    <script>
    // Loader animation: hide main content for 2 seconds
    document.addEventListener('DOMContentLoaded', function() {
        var loader = document.getElementById('loader-bg');
        var app = document.querySelector('.app-container');
        // Solo oculta el contenido principal, no el fondo animado
        app.style.visibility = 'hidden';
        setTimeout(function() {
            loader.style.opacity = '0';
            setTimeout(function() {
                loader.style.display = 'none';
                app.style.visibility = 'visible';
            }, 500);
        }, 2000);
    });
    </script>
    <script>
    // Fondo animado y part√≠culas azules sutiles para el header con opacidad
    function createHeaderBgAnimation(canvas, numParticles, gradColors) {
        const ctx = canvas.getContext('2d');
        let particles = [];
        let gradOffset = 0;
        function resize() {
            canvas.width = canvas.clientWidth;
            canvas.height = canvas.clientHeight;
        }
        function createParticles() {
            particles = [];
            for (let i = 0; i < numParticles; i++) {
                particles.push({
                    x: Math.random() * canvas.width,
                    y: Math.random() * canvas.height,
                    r: Math.random() * 2 + 1.5,
                    dx: (Math.random() - 0.5) * 0.3,
                    dy: (Math.random() - 0.5) * 0.3,
                    alpha: Math.random() * 0.3 + 0.15
                });
            }
        }
        function drawGradient() {
            gradOffset += 0.5;
            const grad = ctx.createLinearGradient(0, gradOffset % canvas.height, canvas.width, canvas.height - gradOffset % canvas.height);
            grad.addColorStop(0, gradColors[0]);
            grad.addColorStop(0.5, gradColors[1]);
            grad.addColorStop(1, gradColors[2]);
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        function drawParticles() {
            for (let p of particles) {
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
                ctx.fillStyle = `rgba(59,130,246,${p.alpha})`;
                ctx.shadowColor = '#3b82f6';
                ctx.shadowBlur = 8;
                ctx.fill();
                ctx.shadowBlur = 0;
                p.x += p.dx;
                p.y += p.dy;
                if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
                if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
            }
        }
        function animate() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawGradient();
            drawParticles();
            requestAnimationFrame(animate);
        }
        function init() {
            resize();
            createParticles();
            animate();
        }
        window.addEventListener('resize', () => {
            resize();
            createParticles();
        });
        setTimeout(init, 200);
    }
    createHeaderBgAnimation(
        document.getElementById('header-canvas'),
        10,
        ['rgba(59,130,246,0.22)','rgba(59,130,246,0.10)','rgba(0,0,0,0.5)']
    );
    </script>
    <script>
    // Fondo animado y part√≠culas azules sutiles
    const canvas = document.getElementById('bg-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];
    let gradOffset = 0;

    function resizeCanvas() {
        const container = document.querySelector('.app-container');
        canvas.width = container.clientWidth;
        canvas.height = container.clientHeight;
    }

    function createParticles(num) {
        particles = [];
        for (let i = 0; i < num; i++) {
            particles.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                r: Math.random() * 2 + 1.5,
                dx: (Math.random() - 0.5) * 0.3,
                dy: (Math.random() - 0.5) * 0.3,
                alpha: Math.random() * 0.3 + 0.15
            });
        }
    }

    function drawGradient() {
        gradOffset += 0.5;
        const grad = ctx.createLinearGradient(0, gradOffset % canvas.height, canvas.width, canvas.height - gradOffset % canvas.height);
        grad.addColorStop(0, 'rgba(59,130,246,0.18)');
        grad.addColorStop(0.5, 'rgba(59,130,246,0.08)');
        grad.addColorStop(1, 'rgba(0,0,0,0.7)');
        ctx.fillStyle = grad;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    }

    function drawParticles() {
        for (let p of particles) {
            ctx.beginPath();
            ctx.arc(p.x, p.y, p.r, 0, 2 * Math.PI);
            ctx.fillStyle = `rgba(59,130,246,${p.alpha})`;
            ctx.shadowColor = '#3b82f6';
            ctx.shadowBlur = 8;
            ctx.fill();
            ctx.shadowBlur = 0;
            p.x += p.dx;
            p.y += p.dy;
            // Rebote en bordes
            if (p.x < 0 || p.x > canvas.width) p.dx *= -1;
            if (p.y < 0 || p.y > canvas.height) p.dy *= -1;
        }
    }

    function animate() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawGradient();
        drawParticles();
        requestAnimationFrame(animate);
    }

    function initBg() {
        resizeCanvas();
        createParticles(Math.max(18, Math.floor(canvas.width * canvas.height / 12000)));
        animate();
    }

    window.addEventListener('resize', () => {
        resizeCanvas();
        createParticles(Math.max(18, Math.floor(canvas.width * canvas.height / 12000)));
    });
    // Esperar a que el layout est√© listo
    setTimeout(initBg, 200);
    </script>
    <script>
    // Popup animation for purchase
    function showPurchasePopup(msg) {
        const popup = document.getElementById('purchasePopup');
        document.getElementById('purchaseMsg').textContent = msg;
        popup.style.display = 'flex';
        // Confetti desde arriba y cae hacia abajo
        const confetti = document.getElementById('confettiContainer');
        confetti.innerHTML = '';
        for(let i=0;i<32;i++){
            const c = document.createElement('div');
            c.style.position='absolute';
            c.style.width='8px';c.style.height='18px';
            c.style.background=`hsl(${Math.random()*360},90%,60%)`;
            c.style.left=Math.random()*100+'%';
            c.style.top='0';
            c.style.borderRadius='4px';
            c.style.opacity='0.85';
            c.style.transform=`rotate(${Math.random()*360}deg)`;
            c.animate([
                {top:'0',opacity:1},
                {top:'90%',opacity:0.2}
            ],{duration:1200+Math.random()*600,fill:'forwards'});
            confetti.appendChild(c);
        }
        setTimeout(()=>{
            popup.style.display='none';
        },1800);
    }
    </script>
</body>
</html>

